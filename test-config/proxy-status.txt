



HTTP Working Group                                         M. Nottingham
Internet-Draft                                                    Fastly
Intended status: Standards Track                               P. Sikora
Expires: May 2, 2020                                              Google
                                                        October 30, 2019


                   The Proxy-Status HTTP Header Field
                 draft-ietf-httpbis-proxy-status-latest

Abstract

   This document defines the Proxy-Status HTTP header field to convey
   the details of errors generated by HTTP intermediaries.

Note to Readers

   _RFC EDITOR: please remove this section before publication_

   Discussion of this draft takes place on the HTTP working group
   mailing list (ietf-http-wg@w3.org), which is archived at
   https://lists.w3.org/Archives/Public/ietf-http-wg/ [1].

   Working Group information can be found at https://httpwg.org/ [2];
   source code and issues list for this draft can be found at
   https://github.com/httpwg/http-extensions/labels/proxy-status [3].

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on May 2, 2020.








Nottingham & Sikora        Expires May 2, 2020                  [Page 1]

Internet-Draft                Proxy-Status                  October 2019


Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   3
     1.1.  Notational Conventions  . . . . . . . . . . . . . . . . .   4
   2.  The Proxy-Status HTTP Header Field  . . . . . . . . . . . . .   4
     2.1.  Generic Proxy Status Parameters . . . . . . . . . . . . .   6
   3.  Proxy Status Types  . . . . . . . . . . . . . . . . . . . . .   6
     3.1.  DNS Timeout . . . . . . . . . . . . . . . . . . . . . . .   6
     3.2.  DNS Error . . . . . . . . . . . . . . . . . . . . . . . .   7
     3.3.  Destination Not Found . . . . . . . . . . . . . . . . . .   7
     3.4.  Destination Unavailable . . . . . . . . . . . . . . . . .   7
     3.5.  Destination IP Prohibited . . . . . . . . . . . . . . . .   7
     3.6.  Destination IP Unroutable . . . . . . . . . . . . . . . .   8
     3.7.  Connection Refused  . . . . . . . . . . . . . . . . . . .   8
     3.8.  Connection Terminated . . . . . . . . . . . . . . . . . .   8
     3.9.  Connection Timeout  . . . . . . . . . . . . . . . . . . .   8
     3.10. Connection Read Timeout . . . . . . . . . . . . . . . . .   9
     3.11. Connection Write Timeout  . . . . . . . . . . . . . . . .   9
     3.12. Connection Limit Reached  . . . . . . . . . . . . . . . .   9
     3.13. HTTP Response Status  . . . . . . . . . . . . . . . . . .   9
     3.14. HTTP Incomplete Response  . . . . . . . . . . . . . . . .  10
     3.15. HTTP Protocol Error . . . . . . . . . . . . . . . . . . .  10
     3.16. HTTP Response Header Block Too Large  . . . . . . . . . .  10
     3.17. HTTP Response Header Too Large  . . . . . . . . . . . . .  10
     3.18. HTTP Response Body Too Large  . . . . . . . . . . . . . .  11
     3.19. HTTP Response Transfer-Coding Error . . . . . . . . . . .  11
     3.20. HTTP Response Content-Coding Error  . . . . . . . . . . .  11
     3.21. HTTP Response Timeout . . . . . . . . . . . . . . . . . .  12
     3.22. TLS Handshake Error . . . . . . . . . . . . . . . . . . .  12
     3.23. TLS Untrusted Peer Certificate  . . . . . . . . . . . . .  12
     3.24. TLS Expired Peer Certificate  . . . . . . . . . . . . . .  12
     3.25. TLS Unexpected Peer Certificate . . . . . . . . . . . . .  13
     3.26. TLS Missing Proxy Certificate . . . . . . . . . . . . . .  13



Nottingham & Sikora        Expires May 2, 2020                  [Page 2]

Internet-Draft                Proxy-Status                  October 2019


     3.27. TLS Rejected Proxy Certificate  . . . . . . . . . . . . .  13
     3.28. TLS Error . . . . . . . . . . . . . . . . . . . . . . . .  14
     3.29. HTTP Request Bad Request  . . . . . . . . . . . . . . . .  14
     3.30. HTTP Request Unauthorized . . . . . . . . . . . . . . . .  14
     3.31. HTTP Request Forbidden  . . . . . . . . . . . . . . . . .  14
     3.32. HTTP Request Not Found  . . . . . . . . . . . . . . . . .  15
     3.33. HTTP Request Method Not Allowed . . . . . . . . . . . . .  15
     3.34. HTTP Request Not Acceptable . . . . . . . . . . . . . . .  15
     3.35. HTTP Request Proxy Authentication Required  . . . . . . .  15
     3.36. HTTP Request Timeout  . . . . . . . . . . . . . . . . . .  16
     3.37. HTTP Request Conflict . . . . . . . . . . . . . . . . . .  16
     3.38. HTTP Request Timeout  . . . . . . . . . . . . . . . . . .  16
     3.39. HTTP Request Length Required  . . . . . . . . . . . . . .  17
     3.40. HTTP Request Precondition Failed  . . . . . . . . . . . .  17
     3.41. HTTP Request Payload Too Large  . . . . . . . . . . . . .  17
     3.42. HTTP Request URI Too Long . . . . . . . . . . . . . . . .  17
     3.43. HTTP Request Unsupported Media Type . . . . . . . . . . .  18
     3.44. HTTP Request Range Not Satisfiable  . . . . . . . . . . .  18
     3.45. HTTP Request Expectation Failed . . . . . . . . . . . . .  18
     3.46. HTTP Request Misdirected Request  . . . . . . . . . . . .  18
     3.47. HTTP Request Unprocessable Entity . . . . . . . . . . . .  19
     3.48. HTTP Request Locked . . . . . . . . . . . . . . . . . . .  19
     3.49. HTTP Request Failed Dependency  . . . . . . . . . . . . .  19
     3.50. HTTP Request Too Early  . . . . . . . . . . . . . . . . .  20
     3.51. HTTP Request Upgrade Required . . . . . . . . . . . . . .  20
     3.52. HTTP Request Precondition Required  . . . . . . . . . . .  20
     3.53. HTTP Request Too Many Requests  . . . . . . . . . . . . .  20
     3.54. HTTP Request Header Fields Too Large  . . . . . . . . . .  21
     3.55. HTTP Request Unavailable For Legal Reasons  . . . . . . .  21
     3.56. HTTP Request Denied . . . . . . . . . . . . . . . . . . .  21
     3.57. HTTP Upgrade Failed . . . . . . . . . . . . . . . . . . .  21
     3.58. Proxy Internal Response . . . . . . . . . . . . . . . . .  22
     3.59. Proxy Internal Error  . . . . . . . . . . . . . . . . . .  22
     3.60. Proxy Loop Detected . . . . . . . . . . . . . . . . . . .  22
   4.  Defining New Proxy Status Types . . . . . . . . . . . . . . .  22
   5.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  23
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .  23
   7.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  24
     7.1.  Normative References  . . . . . . . . . . . . . . . . . .  24
     7.2.  Informative References  . . . . . . . . . . . . . . . . .  24
     7.3.  URIs  . . . . . . . . . . . . . . . . . . . . . . . . . .  25
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  25

1.  Introduction

   HTTP intermediaries - including both forward proxies and gateways
   (also known as "reverse proxies") - have become an increasingly
   significant part of HTTP deployments.  In particular, reverse proxies



Nottingham & Sikora        Expires May 2, 2020                  [Page 3]

Internet-Draft                Proxy-Status                  October 2019


   and Content Delivery Networks (CDNs) form part of the critical
   infrastructure of many Web sites.

   Typically, HTTP intermediaries forward requests towards the origin
   server and then forward their responses back to clients.  However, if
   an error occurs, the response is generated by the intermediary
   itself.

   HTTP accommodates these types of errors with a few status codes; for
   example, 502 Bad Gateway and 504 Gateway Timeout.  However,
   experience has shown that more information is necessary to aid
   debugging and communicate what's happened to the client.

   To address this, Section 2 defines a new HTTP response header field
   to convey such information, using the Proxy Status Types defined in
   Section 3.  Section 4 explains how to define new Proxy Status Types.

1.1.  Notational Conventions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

   This specification uses Structured Headers
   [I-D.ietf-httpbis-header-structure] to specify syntax.  The terms sh-
   param-list, sh-item, sh-string, sh-token and sh-integer refer to the
   structured types defined therein.

   Note that in this specification, "proxy" is used to indicate both
   forward and reverse proxies, otherwise known as gateways.  "Next hop"
   indicates the connection in the direction leading to the origin
   server for the request.

2.  The Proxy-Status HTTP Header Field

   The Proxy-Status HTTP response header field allows an intermediary to
   indicate the nature and details of an error condition it encounters
   when servicing a request.

   It is a Structured Headers [I-D.ietf-httpbis-header-structure]
   Parameterised List, where each item in the list indicates an error
   condition.  Typically, it will have only one param-item (the error
   condition that triggered generation of the response it occurs
   within), but more than one value is not prohibited.





Nottingham & Sikora        Expires May 2, 2020                  [Page 4]

Internet-Draft                Proxy-Status                  October 2019


   Each param-item's primary-id is a Proxy Status Type, a registered
   value that indicates the nature of the error.

   Each param-item can have zero to many parameters.  Section 2.1 lists
   parameters that can be used with all Proxy Status Types; individual
   types can define additional parameters to use with them.  All
   parameters are optional; see Section 6 for their potential security
   impact.

   For example:


   HTTP/1.1 504 Gateway Timeout

   Proxy-Status: connection_timeout; proxy=SomeCDN; origin=abc; tries=3


   indicates the specific nature of the timeout as a connect timeout to
   the origin with the identifier "abc", and that is was generated by
   the intermediary that identifies itself as "SomeCDN."  Furthermore,
   three connection attempts were made.

   Or:


   HTTP/1.1 429 Too Many Requests

   Proxy-Status: http_request_error; proxy=SomeReverseProxy


   indicates that this 429 Too Many Requests response was generated by
   the intermediary, not the origin.

   Each Proxy Status Type has a Recommended HTTP Status Code.  When
   generating a HTTP response containing Proxy-Status, its HTTP status
   code SHOULD be set to the Recommended HTTP Status Code.  However,
   there may be circumstances (e.g., for backwards compatibility with
   previous behaviours) when another status code might be used.

   Section 3 lists the Proxy Status Types defined in this document; new
   ones can be defined using the procedure outlined in Section 4.

   Proxy-Status MAY be sent in HTTP trailers, but - as with all trailers
   - it might be silently discarded along the path to the user agent,
   this SHOULD NOT be done unless it is not possible to send it in
   headers.  For example, if an intermediary is streaming a response and
   the upstream connection suddenly terminates, Proxy-Status can be




Nottingham & Sikora        Expires May 2, 2020                  [Page 5]

Internet-Draft                Proxy-Status                  October 2019


   appended to the trailers of the outgoing message (since the headers
   have already been sent).

   Note that there are various security considerations for
   intermediaries using the Proxy-Status header field; see Section 6.

   Origin servers MUST NOT generate the Proxy-Status header field.

2.1.  Generic Proxy Status Parameters

   This section lists parameters that are potentially applicable to most
   Proxy Status Types.

   o  node - a sh-string identifying the intermediary generating this
      Proxy Status Type.  MAY be a hostname, IP address, or alias.

   o  origin - a sh-string identifying the origin server whose behaviour
      triggered this response.  MAY be a hostname, IP address, or alias.

   o  protocol - a sh-token indicating the ALPN protocol identifier
      [RFC7301] used to connect to the next hop.  This is only
      applicable when that connection was actually established.

   o  tries - a sh-integer indicating the number of times that the
      indicated error occurred when attempting to satisfy the request.

   o  details - a sh-string containing additional information not
      captured anywhere else.  This can include implementation-specific
      or deployment-specific information.

3.  Proxy Status Types

   This section lists the Proxy Status Types defined by this document.
   See Section 4 for information about defining new Proxy Status Types.

3.1.  DNS Timeout

   o  Name: dns_timeout

   o  Description: The intermediary encountered a timeout when trying to
      find an IP address for the destination hostname.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 504






Nottingham & Sikora        Expires May 2, 2020                  [Page 6]

Internet-Draft                Proxy-Status                  October 2019


3.2.  DNS Error

   o  Name: dns_error

   o  Description: The intermediary encountered a DNS error when trying
      to find an IP address for the destination hostname.

   o  Extra Parameters:

      *  rcode: A sh-string conveying the DNS RCODE that indicates the
         error type.  See [RFC8499], Section 3.

   o  Recommended HTTP status code: 502

3.3.  Destination Not Found

   o  Name: destination_not_found

   o  Description: The intermediary cannot determine the appropriate
      next hop to use for this request; for example, it may not be
      configured.  Note that this error is specific to gateways, which
      typically require specific configuration to identify the "backend"
      server; forward proxies use in-band information to identify the
      origin server.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 500

3.4.  Destination Unavailable

   o  Name: destination_unavailable

   o  Description: The intermediary considers the next hop to be
      unavailable; e.g., recent attempts to communicate with it may have
      failed, or a health check may indicate that it is down.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 503

3.5.  Destination IP Prohibited

   o  Name: destination_ip_prohibited

   o  Description: The intermediary is configured to prohibit
      connections to the destination IP address.




Nottingham & Sikora        Expires May 2, 2020                  [Page 7]

Internet-Draft                Proxy-Status                  October 2019


   o  Extra Parameters: None.

   o  Recommended HTTP status code: 502

3.6.  Destination IP Unroutable

   o  Name: destination_ip_unroutable

   o  Description: The intermediary cannot find a route to the next hop
      IP address.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 502

3.7.  Connection Refused

   o  Name: connection_refused

   o  Description: The intermediary's connection to the next hop was
      refused.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 502

3.8.  Connection Terminated

   o  Name: connection_terminated

   o  Description: The intermediary's connection to the next hop was
      closed before any part of the response was received.  If some part
      was received, see http_response_incomplete.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 502

3.9.  Connection Timeout

   o  Name: connection_timeout

   o  Description: The intermediary's attempt to open a connection to
      the next hop timed out.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 504



Nottingham & Sikora        Expires May 2, 2020                  [Page 8]

Internet-Draft                Proxy-Status                  October 2019


3.10.  Connection Read Timeout

   o  Name: connection_read_timeout

   o  Description: The intermediary was expecting data on a connection
      (e.g., part of a response), but did not receive any new data in a
      configured time limit.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 504

3.11.  Connection Write Timeout

   o  Name: connection_write_timeout

   o  Description: The intermediary was attempting to write data to a
      connection, but was not able to (e.g., because its buffers were
      full).

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 504

3.12.  Connection Limit Reached

   o  Name: connnection_limit_reached

   o  Description: The intermediary is configured to limit the number of
      connections it has to the next hop, and that limit has been
      passed.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 503

3.13.  HTTP Response Status

   o  Name: http_response_status

   o  Description: The intermediary has received a response from the
      next hop and forwarded it to the client.

   o  Extra Parameters: None.

   o  Recommended HTTP status code:





Nottingham & Sikora        Expires May 2, 2020                  [Page 9]

Internet-Draft                Proxy-Status                  October 2019


3.14.  HTTP Incomplete Response

   o  Name: http_response_incomplete

   o  Description: The intermediary received an incomplete response to
      the request from the next hop.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 502

3.15.  HTTP Protocol Error

   o  Name: http_protocol_error

   o  Description: The intermediary encountered a HTTP protocol error
      when communicating with the next hop.  This error should only be
      used when a more specific one is not defined.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 502

3.16.  HTTP Response Header Block Too Large

   o  Name: http_response_header_block_size

   o  Description: The intermediary received a response to the request
      whose header block was considered too large.

   o  Extra Parameters:

      *  header_block_size: a sh-integer indicating how large the
         headers received were.  Note that they might not be complete;
         i.e., the intermediary may have discarded or refused additional
         data.

   o  Recommended HTTP status code: 502

3.17.  HTTP Response Header Too Large

   o  Name: http_response_header_size

   o  Description: The intermediary received a response to the request
      containing an individual header line that was considered too
      large.

   o  Extra Parameters:



Nottingham & Sikora        Expires May 2, 2020                 [Page 10]

Internet-Draft                Proxy-Status                  October 2019


      *  header_name: a sh-string indicating the name of the header that
         triggered the error.

   o  Recommended HTTP status code: 502

3.18.  HTTP Response Body Too Large

   o  Name: http_response_body_size

   o  Description: The intermediary received a response to the request
      whose body was considered too large.

   o  Extra Parameters:

      *  body_size: a sh-integer indicating how large the body received
         was.  Note that it may not have been complete; i.e., the
         intermediary may have discarded or refused additional data.

   o  Recommended HTTP status code: 502

3.19.  HTTP Response Transfer-Coding Error

   o  Name: http_response_transfer_coding

   o  Description: The intermediary encountered an error decoding the
      transfer-coding of the response.

   o  Extra Parameters:

      *  coding: a sh-token containing the specific coding that caused
         the error.

   o  Recommended HTTP status code: 502

3.20.  HTTP Response Content-Coding Error

   o  Name: http_response_content_coding

   o  Description: The intermediary encountered an error decoding the
      content-coding of the response.

   o  Extra Parameters:

      *  coding: a sh-token containing the specific coding that caused
         the error.

   o  Recommended HTTP status code: 502




Nottingham & Sikora        Expires May 2, 2020                 [Page 11]

Internet-Draft                Proxy-Status                  October 2019


3.21.  HTTP Response Timeout

   o  Name: http_response_timeout

   o  Description: The intermediary reached a configured time limit
      waiting for the complete response.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 504

3.22.  TLS Handshake Error

   o  Name: tls_handshake_error

   o  Description: The intermediary encountered an error during TLS
      handshake with the next hop.

   o  Extra Parameters:

      *  alert_message: a sh-token containing the applicable description
         string from the TLS Alerts registry.

   o  Recommended HTTP status code: 502

3.23.  TLS Untrusted Peer Certificate

   o  Name: tls_untrusted_peer_certificate

   o  Description: The intermediary received untrusted peer certificate
      during TLS handshake with the next hop.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 502

3.24.  TLS Expired Peer Certificate

   o  Name: tls_expired_peer_certificate

   o  Description: The intermediary received expired peer certificate
      during TLS handshake with the next hop.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 502





Nottingham & Sikora        Expires May 2, 2020                 [Page 12]

Internet-Draft                Proxy-Status                  October 2019


3.25.  TLS Unexpected Peer Certificate

   o  Name: tls_unexpected_peer_certificate

   o  Description: The intermediary received unexpected peer certificate
      (e.g., SPKI doesn't match) during TLS handshake with the next hop.

   o  Extra Parameters:

      *  identity: a sh-string containing a comma-separated list of
         Subject Alternative Names from the certificate received from
         the next hop.

      *  sha256: a sh-string containing the hex-encoded SHA-256 of the
         certificate received from the next hop.

      *  spki: a sh-string containing the base64-encoded SHA-256 of the
         Subject Public Key Info (SPKI) from the certificate received
         from the next hop.

   o  Recommended HTTP status code: 502

3.26.  TLS Missing Proxy Certificate

   o  Name: tls_missing_proxy_certificate

   o  Description: The next hop requested client certificate from the
      intermediary during TLS handshake, but it wasn't configured with
      one.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 500

3.27.  TLS Rejected Proxy Certificate

   o  Name: tls_rejected_proxy_certificate

   o  Description: The next hop rejected client certificate provided by
      the intermediary during TLS handshake.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 500







Nottingham & Sikora        Expires May 2, 2020                 [Page 13]

Internet-Draft                Proxy-Status                  October 2019


3.28.  TLS Error

   o  Name: tls_error

   o  Description: The intermediary encountered a TLS error when
      communicating with the next hop.

   o  Extra Parameters:

      *  alert_message: a sh-token containing the applicable description
         string from the TLS Alerts registry.

   o  Recommended HTTP status code: 502

3.29.  HTTP Request Bad Request

   o  Name: http_request_bad_request

   o  Description: The intermediary is generating a 400 (Bad Request)
      response on the origin's behalf.  This proxy status type helps
      distinguish between responses generated by intermediaries from
      those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 400

3.30.  HTTP Request Unauthorized

   o  Name: http_request_unauthorized

   o  Description: The intermediary is generating a 401 (Unauthorized)
      response on the origin's behalf.  This proxy status type helps
      distinguish between responses generated by intermediaries from
      those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 401

3.31.  HTTP Request Forbidden

   o  Name: http_request_forbidden

   o  Description: The intermediary is generating a 403 (Forbidden)
      response on the origin's behalf.  This proxy status type helps
      distinguish between responses generated by intermediaries from
      those generated by the origin.



Nottingham & Sikora        Expires May 2, 2020                 [Page 14]

Internet-Draft                Proxy-Status                  October 2019


   o  Extra Parameters: None.

   o  Recommended HTTP status code: 403

3.32.  HTTP Request Not Found

   o  Name: http_request_not_found

   o  Description: The intermediary is generating a 404 (Not Found)
      response on the origin's behalf.  This proxy status type helps
      distinguish between responses generated by intermediaries from
      those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 404

3.33.  HTTP Request Method Not Allowed

   o  Name: http_request_method_not_allowed

   o  Description: The intermediary is generating a 405 (Method Not
      Allowed) response on the origin's behalf.  This proxy status type
      helps distinguish between responses generated by intermediaries
      from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 405

3.34.  HTTP Request Not Acceptable

   o  Name: http_request_not_acceptable

   o  Description: The intermediary is generating a 406 (Not Acceptable)
      response on the origin's behalf.  This proxy status type helps
      distinguish between responses generated by intermediaries from
      those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 406

3.35.  HTTP Request Proxy Authentication Required

   o  Name: http_request_proxy_authentication_required





Nottingham & Sikora        Expires May 2, 2020                 [Page 15]

Internet-Draft                Proxy-Status                  October 2019


   o  Description: The intermediary is generating a 407 (Proxy
      Authentication Required) response on the origin's behalf.  This
      proxy status type helps distinguish between responses generated by
      intermediaries from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 407

3.36.  HTTP Request Timeout

   o  Name: http_request_timeout

   o  Description: The intermediary is generating a 408 (Request
      Timeout) response on the origin's behalf.  This proxy status type
      helps distinguish between responses generated by intermediaries
      from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 408

3.37.  HTTP Request Conflict

   o  Name: http_request_conflict

   o  Description: The intermediary is generating a 408 (Conflict)
      response on the origin's behalf.  This proxy status type helps
      distinguish between responses generated by intermediaries from
      those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 409

3.38.  HTTP Request Timeout

   o  Name: http_request_gone

   o  Description: The intermediary is generating a 410 (Gone) response
      on the origin's behalf.  This proxy status type helps distinguish
      between responses generated by intermediaries from those generated
      by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 410




Nottingham & Sikora        Expires May 2, 2020                 [Page 16]

Internet-Draft                Proxy-Status                  October 2019


3.39.  HTTP Request Length Required

   o  Name: http_request_length_required

   o  Description: The intermediary is generating a 411 (Length
      Required) response on the origin's behalf.  This proxy status type
      helps distinguish between responses generated by intermediaries
      from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 411

3.40.  HTTP Request Precondition Failed

   o  Name: http_request_precondition_failed

   o  Description: The intermediary is generating a 412 (Precondition
      Failed) response on the origin's behalf.  This proxy status type
      helps distinguish between responses generated by intermediaries
      from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 412

3.41.  HTTP Request Payload Too Large

   o  Name: http_request_payload_too_large

   o  Description: The intermediary is generating a 413 (Payload Too
      Large) response on the origin's behalf.  This proxy status type
      helps distinguish between responses generated by intermediaries
      from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 413

3.42.  HTTP Request URI Too Long

   o  Name: http_request_uri_too_long

   o  Description: The intermediary is generating a 414 (URI Too Long)
      response on the origin's behalf.  This proxy status type helps
      distinguish between responses generated by intermediaries from
      those generated by the origin.




Nottingham & Sikora        Expires May 2, 2020                 [Page 17]

Internet-Draft                Proxy-Status                  October 2019


   o  Extra Parameters: None.

   o  Recommended HTTP status code: 414

3.43.  HTTP Request Unsupported Media Type

   o  Name: http_request_unsupported_media_type

   o  Description: The intermediary is generating a 415 (Unsupported
      Media Type) response on the origin's behalf.  This proxy status
      type helps distinguish between responses generated by
      intermediaries from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 415

3.44.  HTTP Request Range Not Satisfiable

   o  Name: http_request_range_not_satisfiable

   o  Description: The intermediary is generating a 416 (Range Not
      Satisfiable) response on the origin's behalf.  This proxy status
      type helps distinguish between responses generated by
      intermediaries from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 416

3.45.  HTTP Request Expectation Failed

   o  Name: http_request_expectation_failed

   o  Description: The intermediary is generating a 417 (Expectation
      Failed) response on the origin's behalf.  This proxy status type
      helps distinguish between responses generated by intermediaries
      from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 417

3.46.  HTTP Request Misdirected Request

   o  Name: http_request_misdirected_request





Nottingham & Sikora        Expires May 2, 2020                 [Page 18]

Internet-Draft                Proxy-Status                  October 2019


   o  Description: The intermediary is generating a 421 (Misdirected
      Request) response on the origin's behalf.  This proxy status type
      helps distinguish between responses generated by intermediaries
      from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 421

3.47.  HTTP Request Unprocessable Entity

   o  Name: http_request_unprocessable_entity

   o  Description: The intermediary is generating a 422 (Unprocessable
      Entity) response on the origin's behalf.  This proxy status type
      helps distinguish between responses generated by intermediaries
      from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 422

3.48.  HTTP Request Locked

   o  Name: http_request_locked

   o  Description: The intermediary is generating a 423 (Locked)
      response on the origin's behalf.  This proxy status type helps
      distinguish between responses generated by intermediaries from
      those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 423

3.49.  HTTP Request Failed Dependency

   o  Name: http_request_failed_dependency

   o  Description: The intermediary is generating a 424 (Failed
      Dependency) response on the origin's behalf.  This proxy status
      type helps distinguish between responses generated by
      intermediaries from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 424




Nottingham & Sikora        Expires May 2, 2020                 [Page 19]

Internet-Draft                Proxy-Status                  October 2019


3.50.  HTTP Request Too Early

   o  Name: http_request_too_early

   o  Description: The intermediary is generating a 425 (Too Early)
      response on the origin's behalf.  This proxy status type helps
      distinguish between responses generated by intermediaries from
      those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 425

3.51.  HTTP Request Upgrade Required

   o  Name: http_request_upgrade_required

   o  Description: The intermediary is generating a 426 (Upgrade
      Required) response on the origin's behalf.  This proxy status type
      helps distinguish between responses generated by intermediaries
      from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 426

3.52.  HTTP Request Precondition Required

   o  Name: http_request_precondition_required

   o  Description: The intermediary is generating a 428 (Precondition
      Required) response on the origin's behalf.  This proxy status type
      helps distinguish between responses generated by intermediaries
      from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 428

3.53.  HTTP Request Too Many Requests

   o  Name: http_request_too_many_requests

   o  Description: The intermediary is generating a 429 (Too Many
      Requests) response on the origin's behalf.  This proxy status type
      helps distinguish between responses generated by intermediaries
      from those generated by the origin.




Nottingham & Sikora        Expires May 2, 2020                 [Page 20]

Internet-Draft                Proxy-Status                  October 2019


   o  Extra Parameters: None.

   o  Recommended HTTP status code: 429

3.54.  HTTP Request Header Fields Too Large

   o  Name: http_request_header_fields_too_large

   o  Description: The intermediary is generating a 431 (Request Header
      Fields Too Large) response on the origin's behalf.  This proxy
      status type helps distinguish between responses generated by
      intermediaries from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 431

3.55.  HTTP Request Unavailable For Legal Reasons

   o  Name: http_request_unavailable_for_legal_reasons

   o  Description: The intermediary is generating a 451 (Unavailable For
      Legal Reasons) response on the origin's behalf.  This proxy status
      type helps distinguish between responses generated by
      intermediaries from those generated by the origin.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 451

3.56.  HTTP Request Denied

   o  Name: http_request_denied

   o  Description: The intermediary rejected HTTP request based on its
      configuration and/or policy settings.  The request wasn't
      forwarded to the next hop.

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 400

3.57.  HTTP Upgrade Failed

   o  Name: http_upgrade_failed

   o  Description: The HTTP Upgrade between the intermediary and the
      next hop failed.



Nottingham & Sikora        Expires May 2, 2020                 [Page 21]

Internet-Draft                Proxy-Status                  October 2019


   o  Extra Parameters: None.

   o  Recommended HTTP status code: 502

3.58.  Proxy Internal Response

   o  Name: proxy_internal_response

   o  Description: The intermediary generated the response locally,
      without attempting to connect to the next hop (e.g. in response to
      a request to a debug endpoint terminated at the intermediary).

   o  Extra Parameters: None.

   o  Recommended HTTP status code:

3.59.  Proxy Internal Error

   o  Name: proxy_internal_error

   o  Description: The intermediary encountered an internal error
      unrelated to the origin.

   o  Extra Parameters:

      *  error: a sh-string containing details about the error
         condition.

   o  Recommended HTTP status code: 500

3.60.  Proxy Loop Detected

   o  Name: proxy_loop_detected

   o  Description: The intermediary tried to forward the request to
      itself, or a loop has been detected using different means (e.g.
      [RFC8586]).

   o  Extra Parameters: None.

   o  Recommended HTTP status code: 502

4.  Defining New Proxy Status Types

   New Proxy Status Types can be defined by registering them in the HTTP
   Proxy Status Types registry.





Nottingham & Sikora        Expires May 2, 2020                 [Page 22]

Internet-Draft                Proxy-Status                  October 2019


   Registration requests are reviewed and approved by a Designated
   Expert, as per [RFC8126], Section 4.5.  A specification document is
   appreciated, but not required.

   The Expert(s) should consider the following factors when evaluating
   requests:

   o  Community feedback

   o  If the value is sufficiently well-defined

   o  If the value is generic; vendor-specific, application-specific and
      deployment-specific values are discouraged

   Registration requests should use the following template:

   o  Name: [a name for the Proxy Status Type that is allowable as a sh-
      param-list key]

   o  Description: [a description of the conditions that generate the
      Proxy Status Types]

   o  Extra Parameters: [zero or more optional parameters, typed using
      one of the types available in sh-item]

   o  Recommended HTTP status code: [the appropriate HTTP status code
      for this entry]

   See the registry at https://iana.org/assignments/http-proxy-statuses
   [4] for details on where to send registration requests.

5.  IANA Considerations

   Upon publication, please create the HTTP Proxy Status Types registry
   at https://iana.org/assignments/http-proxy-statuses [5] and populate
   it with the types defined in Section 3; see Section 4 for its
   associated procedures.

6.  Security Considerations

   One of the primary security concerns when using Proxy-Status is
   leaking information that might aid an attacker.

   As a result, care needs to be taken when deciding to generate a
   Proxy-Status header.  Note that intermediaries are not required to
   generate a Proxy-Status header field in any response, and can
   conditionally generate them based upon request attributes (e.g.,
   authentication tokens, IP address).



Nottingham & Sikora        Expires May 2, 2020                 [Page 23]

Internet-Draft                Proxy-Status                  October 2019


   Likewise, generation of all parameters is optional.

   Special care needs to be taken in generating proxy and origin
   parameters, as they can expose information about the intermediary's
   configuration and back-end topology.

7.  References

7.1.  Normative References

   [I-D.ietf-httpbis-header-structure]
              Nottingham, M. and P. Kamp, "Structured Headers for HTTP",
              draft-ietf-httpbis-header-structure-13 (work in progress),
              August 2019.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC7301]  Friedl, S., Popov, A., Langley, A., and E. Stephan,
              "Transport Layer Security (TLS) Application-Layer Protocol
              Negotiation Extension", RFC 7301, DOI 10.17487/RFC7301,
              July 2014, <https://www.rfc-editor.org/info/rfc7301>.

   [RFC8126]  Cotton, M., Leiba, B., and T. Narten, "Guidelines for
              Writing an IANA Considerations Section in RFCs", BCP 26,
              RFC 8126, DOI 10.17487/RFC8126, June 2017,
              <https://www.rfc-editor.org/info/rfc8126>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

   [RFC8499]  Hoffman, P., Sullivan, A., and K. Fujiwara, "DNS
              Terminology", BCP 219, RFC 8499, DOI 10.17487/RFC8499,
              January 2019, <https://www.rfc-editor.org/info/rfc8499>.

7.2.  Informative References

   [RFC8586]  Ludin, S., Nottingham, M., and N. Sullivan, "Loop
              Detection in Content Delivery Networks (CDNs)", RFC 8586,
              DOI 10.17487/RFC8586, April 2019,
              <https://www.rfc-editor.org/info/rfc8586>.







Nottingham & Sikora        Expires May 2, 2020                 [Page 24]

Internet-Draft                Proxy-Status                  October 2019


7.3.  URIs

   [1] https://lists.w3.org/Archives/Public/ietf-http-wg/

   [2] https://httpwg.org/

   [3] https://github.com/httpwg/http-extensions/labels/proxy-status

   [4] https://iana.org/assignments/http-proxy-statuses

   [5] https://iana.org/assignments/http-proxy-statuses

Authors' Addresses

   Mark Nottingham
   Fastly

   Email: mnot@mnot.net
   URI:   https://www.mnot.net/


   Piotr Sikora
   Google

   Email: piotrsikora@google.com


























Nottingham & Sikora        Expires May 2, 2020                 [Page 25]
